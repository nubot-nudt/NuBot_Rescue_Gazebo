# Nubot_Pumbaa_Gazebo_Plugin
This is a Gazebo simulation plugin of NuBot_Pumbaa tracked vehicle.  
Generated by skywalker1941 from NuBot team.  

## Features Description
1.Use joy & rostopic to control the velocity & direction & flippers angle.  
2.Publish the robot pose through rostopic.  
3.The robot tracks motion mechanism is based on the work of Martin Pecka.  

>M. Pecka, K. Zimmermann, and T. Svoboda, “Fast simulation of vehicles with non-deformable tracks,” Sep. 2017, pp. 6414–6419, doi: 10.1109/IROS.2017.8206546.

4.The flippers are controlled by directly setting the angle to the model.  

## Environment Requirements
Ubuntu 18.04  
ROS melodic  
Gazebo 9.0.0  
Python 3.6  

## Additional Configurations
opende head files (details are described later)  
threadpool libraries (maybe needed)  

## Files Descriptions

>/gazebo_deps_opende  

This is a folder copy from the source code of gazebo(gazebo/deps/opende). It contains some head files needed by the plugin.  

>/Reference_File

This is a folder contains the original code of Martin Peica's work.  

>/Reference_File/threadpool-0_2_5-src.zip

This is a library pakage that may be needed during compilation. Just install it to the system. 
（copy /boost/threadpool.hpp & threadpool/ to /usr/include/boost/ or /usr/local/include/boost/)  
`sudo cp boost/threadpool.hpp /usr/include/boost/threadpool.hpp`
`sudo cp -r boost/threadpool/ /usr/include/boost/threadpool/`

>/gazebo_description

The modle of robot & obstacles in the environment, including ".sdf" & ".world" file.  

>/pumbaa_plugin

The core code of NuBot_Pumbaa_Gazebo Plugin.  

>/nubot_msgs

The self defined ROS message for Pumbaa control.  

>/nubot_teleop

The joy teleop code of NuBot_Pumbaa in Python3.

## Compilation Note

use  
```c++
mkdir src
cd src/
git pull https://github.com/skywalker1941/NuBot_Pummba_Gazebo.git
cd ..
catkin_make
```
to compile the project.  

## Run the Project
After compilation, run:  
```c++
roscore
source devel/setup.bash
roslaunch src/launch/pumbaa_lab.launch
```
for LiDAR RS-Helios & IMU in .sdf format, run:
`roslaunch src/launch/pumbaa_lidar_sdf.launch`

## Control the Robot
rostopic:"/nubot_msgs/base_drive_cmd".  
rostopic:"/nubot_msgs/base_auto_cmd".  
#### DualShock4 (PS4 joystick)
```c++
rosrun joy joy_node
rosrun nubot_teleop teleop_base2_gazebo_joy.py
```
with rostopic:"/nubot_msgs/base_drive_cmd".  
#### TODO:Keyboard (message type: self-defined)  
```c++
rosrun nubot_teleop teleop_keyboard.py
```
with rostopic:"/nubot_msgs/base_drive_cmd".  
#### Keyboard (message type: "geometry_msgs::Twist")  
```c++
rosrun nubot_teleop teleop_twist_keyboard.py
```
with rostopic:"/nubot_msgs/base_auto_cmd".  
This topic is in "geometry_msgs::Twist" type, which can be used in auto navigation.  

## Read sensor data
#### Robot pose
rostopic "/gazebo_state/pumbaa_pose"  
#### Robot state (flipper angle, speed...)
rostopic "/nubot_drive/base_info"  
"/nubot_msgs/drive_base_cmd" & "/nubot_drive/base_info" are self defined message types.  

#### LiDAR PointCloud2 
in rostopic "/lidar_points"  
For LiDAR in .sdf format, need to change "Fixed Frame" in Rviz to `rs_helios`, and add rostopic "/lidar_points".  


## Parameter Adjustment
You can adjust most robot & sensors & environment parameters by modifying the ".sdf" & ".world" files.  
Robot:  

>/gazebo_description/models/NuBot_Pumbaa/model.sdf
>/gazebo_description/models/NuBot_Pumbaa_v2/model.sdf

LiDAR:
>/gazebo_description/models/RS_Helios_5515/model.sdf

Installation of sensors:
>/gazebo_description/world/Pumbaa_lidar_labfield.world

robot in '.xacro' format is under development.

you can change mechanical parameters of robot, including friction, flippers PID and so on.  

## TODO
1.Add RGBD camera.  
2.Transfer the robot model .sdf -> .xacro.  
3.Make the simulation more real.  
